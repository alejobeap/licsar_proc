#%Module -*- tcl -*-
## LiCSAR core processing toolbox

proc ModulesHelp { } {
    puts stderr "licsar_proc"
}

module-whatis "licsar_proc"

set LiCSARpath "/gws/nopw/j04/nceo_geohazards_vol1/software/licsar_proc"
puts stdout "source $LiCSARpath/lib/LiCSAR_bash_lib.sh;"

if { [module-info mode load] || [module-info mode switch2] } {
    if { ![is-loaded gamma] } {
        module load gamma/20181130
#temporary solution - we need to use the older version now before i will manage a proper (deep) update
#         module load gamma/20171201
    }
    if { ![is-loaded snaphu] } {
        module load snaphu
    }
#    if { ![is-loaded LiCSAR-pve] } {
#        module load LiCSAR-pve
#    }
    if { ![is-loaded anaconda] } {
        module load anaconda
    }
    if { ![is-loaded nla] } {
        module load nla
    }
    if { ![is-loaded licsar_db] } {
        module load licsar_db
    }
#    puts stdout "source $LiCSARpath/lib/LiCSAR_bash_lib.sh;"
}

prereq snaphu
prereq gamma
prereq anaconda
prereq licsar_db
# prereq LiCSAR-pve
prereq nla

# Set internal variable for path exports
set grouppath "/gws/nopw/j04/nceo_geohazards_vol1"
#set LiCSARpath "/gws/nopw/j04/nceo_geohazards_vol1/software/licsar_proc"
set LiCSAR_procdir "/gws/nopw/j04/nceo_geohazards_vol1/projects/LiCS/proc/current"

#keep the below
set configpath "$grouppath/config/LiCSAR/"
set USER $::env(USER)

#Setup LiCSAR enviroment variables
setenv LiCSARpath "$LiCSARpath"
setenv LiCSAR_temp "/work/scratch/$USER/LiCSAR_temp/"
prepend-path DEMs_DIR "$grouppath/DEMs"
prepend-path ORBs_DIR "$grouppath/orbits/"
setenv LiCSARconfig "$configpath/liveConfig.cnf"
setenv LiCSAR_procdir "/gws/nopw/j04/nceo_geohazards_vol1/projects/LiCS/proc/current"

#setup executable paths
prepend-path PATH "$LiCSARpath/bin"
prepend-path PATH "$LiCSARpath/bin/orig"
prepend-path PATH "$LiCSARpath/bin/scripts"
# prepend-path PATH "$LiCSARpath/external/"
prepend-path PATH "$LiCSARpath/python"

#Setup python path
prepend-path PYTHONPATH "$LiCSARpath/python"
prepend-path PYTHONPATH "$LiCSARpath/python/LiCSAR_lib"
prepend-path PYTHONPATH "$LiCSARpath/python/LiCSAR_db"

# Source LiCSAR bash Library
# strange... it doesn't work when it is here
# but it works when this line is in the beginning of the module..
# but the PYTHONPATH (above) is loaded fully
# strange..... so strange..
# puts stdout "source $LiCSARpath/lib/LiCSAR_bash_lib.sh;"
